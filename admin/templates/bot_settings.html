{% extends "base.html" %}

{% block content %}
<div class="page-header animate-fade-in">
    <h1><i class="bi bi-sliders"></i> הגדרות בוט</h1>
</div>

<!-- בחירת טון וביטויים -->
<div class="card animate-slide-up stagger-1">
    <div class="card-header">
        <span><i class="bi bi-chat-heart"></i> טון תקשורת וביטויים מותאמים</span>
        <span class="badge badge-primary">{{ tone_labels.get(settings.tone, settings.tone) }}</span>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('bot_settings') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

            <!-- בחירת טון -->
            <div class="form-group" style="margin-bottom: var(--space-md);">
                <label class="form-label" style="font-weight: 600; font-size: 1.05rem;">בחירת טון תקשורת</label>
                <div class="text-small text-muted" style="margin-bottom: var(--space-sm);">
                    הטון קובע כיצד הבוט ידבר עם הלקוחות — ידידותי, רשמי, מכירתי או יוקרתי.
                </div>
                <div style="display: flex; flex-direction: column; gap: var(--space-sm);">
                    {% for tone_key, tone_desc in tone_definitions.items() %}
                    <label style="display: flex; align-items: flex-start; gap: var(--space-sm); cursor: pointer;
                                  padding: var(--space-sm); border: 1px solid var(--border-color);
                                  border-radius: var(--radius-md); transition: all 0.2s ease;
                                  {% if settings.tone == tone_key %}background: var(--bg-primary-soft); border-color: var(--primary);{% endif %}">
                        <input type="radio" name="tone" value="{{ tone_key }}"
                               {% if settings.tone == tone_key %}checked{% endif %}
                               style="margin-top: 4px; width: 18px; height: 18px; flex-shrink: 0;">
                        <div>
                            <div style="font-weight: 600;">{{ tone_labels.get(tone_key, tone_key) }}</div>
                            <div class="text-small text-muted">{{ tone_desc }}</div>
                        </div>
                    </label>
                    {% endfor %}
                </div>
            </div>

            <!-- ביטויים מותאמים אישית -->
            <div class="form-group" style="margin-bottom: var(--space-md);">
                <label class="form-label" for="custom_phrases" style="font-weight: 600; font-size: 1.05rem;">
                    ביטויים אופייניים לעסק (אופציונלי)
                </label>
                <div class="text-small text-muted" style="margin-bottom: var(--space-xs);">
                    הזינו 2-3 ביטויים שבעל העסק משתמש בהם ביום-יום (למשל: "אהלן", "בשמחה", "בכיף").
                    הבוט ישלב אותם באופן טבעי בשיחות.
                </div>
                <textarea class="form-control"
                          id="custom_phrases"
                          name="custom_phrases"
                          rows="3"
                          placeholder='למשל: "אהלן ברוכים הבאים", "בשמחה רבה", "תמיד כאן בשבילכם"'>{{ settings.custom_phrases }}</textarea>
            </div>

            <button type="submit" class="btn btn-primary">
                <i class="bi bi-check-lg"></i> שמירת הגדרות
            </button>
        </form>
    </div>
</div>

<!-- תצוגה מקדימה של הפרומפט -->
<div class="card animate-slide-up stagger-2" style="margin-top: var(--space-sm);">
    <div class="card-header">
        <span><i class="bi bi-eye"></i> תצוגה מקדימה — הפרומפט שנשלח למודל</span>
    </div>
    <div class="card-body">
        <div style="background: var(--bg-card); border: 1px solid var(--border-color);
                    border-radius: var(--radius-md); padding: var(--space-md);
                    font-family: monospace; font-size: 0.85rem; direction: rtl;
                    white-space: pre-wrap; line-height: 1.7; max-height: 500px;
                    overflow-y: auto; color: var(--text-secondary);">{{ preview_prompt }}</div>
        <div class="text-small text-muted" style="margin-top: var(--space-xs);">
            זהו הפרומפט הראשי (Layer A) שנשלח למודל השפה בכל שיחה. שינויים בטון או בביטויים ישתקפו מיד.
        </div>
    </div>
</div>
{% endblock %}
