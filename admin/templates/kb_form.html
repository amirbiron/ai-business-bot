{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 1rem;">
    <a href="/kb" class="btn btn-secondary btn-sm">
        <i class="bi bi-arrow-right"></i> חזרה לבסיס הידע
    </a>
</div>

<div class="page-header animate-fade-in">
    <h1><i class="bi bi-pencil-square"></i> {% if entry %}עריכת{% else %}הוספת{% endif %} רשומת בסיס ידע</h1>
</div>

<div class="card animate-slide-up" style="max-width: 800px;">
    <div class="card-body">
        <form method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            {% if gap_id %}<input type="hidden" name="gap_id" value="{{ gap_id }}">{% endif %}

            {% if prefill_question %}
            <div class="alert alert-info" style="margin-bottom: 1rem;">
                <i class="bi bi-question-circle"></i>
                <strong>שאלת לקוח ללא מענה:</strong> {{ prefill_question }}
            </div>
            {% endif %}

            <div class="form-group">
                <label for="category" class="form-label">קטגוריה</label>
                <input type="text" class="form-input" id="category" name="category"
                       value="{{ entry.category if entry else '' }}"
                       list="category-list" required
                       placeholder="לדוגמה: שירותים, מחירון, שאלות נפוצות, מדיניות, שעות, צוות, מיקום">
                <datalist id="category-list">
                    {% for cat in categories %}
                    <option value="{{ cat }}">
                    {% endfor %}
                    <option value="שירותים">
                    <option value="מחירון">
                    <option value="שאלות נפוצות">
                    <option value="מדיניות">
                    <option value="שעות">
                    <option value="צוות">
                    <option value="מיקום">
                    <option value="כללי">
                </datalist>
                <div class="form-hint">הקלידו קטגוריה חדשה או בחרו קיימת.</div>
            </div>

            <div class="form-group">
                <label for="title" class="form-label">כותרת</label>
                <input type="text" class="form-input" id="title" name="title"
                       value="{{ entry.title if entry else '' }}" required
                       placeholder="לדוגמה: מחירון קיץ 2025">
            </div>

            <div class="form-group">
                <label for="content" class="form-label">תוכן</label>
                <textarea class="form-textarea" id="content" name="content" rows="12" required
                          placeholder="הכניסו את התוכן המלא כאן. כללו את כל הפרטים — המערכת תפרק אותו אוטומטית עבור הבינה המלאכותית.">{{ entry.content if entry else '' }}</textarea>
                <div class="form-hint">
                    כתבו בצורה טבעית. המערכת תפרק תוכן ארוך לחלקים קטנים לאחזור AI טוב יותר.
                </div>
            </div>

            <div class="d-flex justify-between" style="margin-top: 1.5rem;">
                <a href="/kb" class="btn btn-secondary">ביטול</a>
                <button type="submit" class="btn btn-primary" style="width: auto;">
                    <i class="bi bi-check-lg"></i> {% if entry %}עדכון{% else %}הוספת{% endif %} רשומה
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
