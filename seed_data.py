"""
Seed Data — מאכלס את מאגר הידע (Knowledge Base) בנתוני הדגמה עבור "מכון היופי של דנה".

הרץ סקריפט זה כדי לאתחל את מסד הנתונים עם מידע עסקי לדוגמה.

שימוש: python -m ai_chatbot.seed_data
"""

import logging

from ai_chatbot import database as db
from ai_chatbot.rag.engine import rebuild_index

logging.basicConfig(level=logging.INFO, format="%(asctime)s [%(levelname)s] %(message)s")
logger = logging.getLogger(__name__)

# ─── Demo Knowledge Base Entries ──────────────────────────────────────────────

DEMO_ENTRIES = [
    # ── Services ──────────────────────────────────────────────────────────
    {
        "category": "Services",
        "title": "שירותי שיער",
        "content": """מכון היופי של דנה מציע מגוון מלא של שירותי שיער מקצועיים:
תספורות:
- תספורת נשים ועיצוב: כולל ייעוץ, חפיפה, תספורת ופן
- תספורת גברים: עיצובים קלאסיים או מודרניים בדיוק מירבי
- תספורת ילדים (עד גיל 12): חוויה עדינה וכיפית לילדים
- גזירת פוני: סידור מהיר של הפוני בין תורים
צבע לשיער:
- צבע מלא: תהליך צביעה מלא מהשורש ועד הקצוות
- גוונים: בטכניקת נייר כסף או בליאז'
- בליאז': צביעה חופשית למראה טבעי ושטוף שמש
- צביעת שורשים: חידוש צבע לשורשים בלבד
- תיקון צבע: תיקון טיפולי צבע קודמים (נדרש ייעוץ מראש)
טיפולי שיער:
- טיפול הזנה עמוק: לחות ושיקום אינטנסיבי
- החלקת קרטין: מפחיתה פריזיות וקיימת 3-4 חודשים
- טיפול קרקפת: טיפול ממוקד לבריאות הקרקפת
- טיפול אולפלקס (Olaplex): טיפול בונה-קשרים לשיער פגום
עיצוב:
- פן ועיצוב: עיצוב שיער מקצועי (Blow-out)
- תסרוקות ערב: לחתונות, נשפים ואירועים מיוחדים
- תסרוקת כלה: עיצוב שיער ליום החתונה (כולל תור ניסיון)"""
    },
    {
        "category": "Services",
        "title": "שירותי ציפורניים",
        "content": """שירותי הציפורניים שלנו כוללים:
מניקור:
- מניקור קלאסי: עיצוב ציפורניים, טיפול בעור שמסביב, עיסוי ידיים ולק
- מניקור ג'ל: לק ג'ל עמיד לאורך זמן (2-3 שבועות)
- מניקור ספא יוקרתי: טיפול מורחב הכולל פילינג, מסכה ומגבת חמה
פדיקור:
- פדיקור קלאסי: השריית רגליים, טיפול בציפורניים, הסרת עור יבש ולק
- פדיקור ג'ל: לק ג'ל עמיד לציפורני הרגליים
- פדיקור ספא יוקרתי: טיפול מלא עם פילינג סוכר, מסכה ועיסוי מורחב
קישוטי ציפורניים (Nail Art):
- עיצוב פשוט: עיצובים בסיסיים על ציפורניים נבחרות
- עיצוב מלא: עיצובים מותאמים אישית על כל הציפורניים
- פרנץ': מניקור פרנץ' קלאסי או צבעוני
בניית ציפורניים:
- סט אקריל מלא: בניית ציפורניים באקריל
- מילוי אקריל: טיפול תחזוקה לבנייה קיימת באקריל
- בנייה בג'ל: הארכת ציפורניים בשיטת ג'ל רך"""
    },
    {
        "category": "Services",
        "title": "טיפולי פנים ועור",
        "content": """טיפולי פנים ועור במכון היופי של דנה:
טיפולי פנים:
- טיפול פנים קלאסי: ניקוי עמוק, פילינג, הוצאת שחורים, מסכה וקרם לחות (60 דק')
- טיפול אנטי-אייג'ינג: טיפול ממוקד עם קולגן ופפטידים (75 דק')
- טיפול לחות: בוסט של לחות אינטנסיבית לעור יבש (60 דק')
- טיפול פנים לאקנה: ניקוי עמוק עם חומצה סליצילית ואור כחול (60 דק')
- טיפול פנים אקספרס: רענון מהיר ללו"ז צפוף (30 דק')
טיפולי עור:
- מיקרודרמבריישן (Microdermabrasion): קילוף עדין ללא גבישים לעור חלק יותר
- פילינג כימי (קל): קילוף עדין להבהרה ושיפור מרקם העור
- טיפול באור (LED Light Therapy): אור אדום או כחול לאנטי-אייג'ינג או אקנה
- דרמפלנינג (Dermaplaning): קילוף עדין המסיר פלומת שיער ותאים מתים"""
    },
    {
        "category": "Services",
        "title": "שעווה והסרת שיער",
        "content": """שירותי שעווה והסרת שיער:
פנים:
- עיצוב גבות: סידור וניקוי
- שפם: הסרת שיער מעל השפה העליונה
- שעווה בפנים (מלא): גבות, שפם, סנטר ופאות
גוף:
- שעווה בבית שחי
- חצי יד / יד מלאה
- חצי רגל / רגל מלאה
- שעווה ברזילאית
- קו ביקיני
- גב / חזה
אנו משתמשים בשעווה קשה ורכה באיכות פרימיום, בהתאם לאזור המטופל, לנוחות ויעילות מקסימלית. כל שירותי השעווה כוללים ניקוי לפני הטיפול וקרם הרגעה לאחריו."""
    },

    # ── Pricing ───────────────────────────────────────────────────────────
    {
        "category": "Pricing",
        "title": "מחירון קיץ 2025",
        "content": """מכון היופי של דנה — מחירון (בתוקף מיוני 2025)
שירותי שיער:
- תספורת נשים ועיצוב: 250₪
- תספורת גברים: 100₪
- תספורת ילדים (עד גיל 12): 80₪
- גזירת פוני: 50₪
- צבע מלא: 250₪-350₪ (תלוי באורך)
- גוונים: 350₪-550₪
- בליאז': 450₪-700₪
- צביעת שורשים: 200₪
- תיקון צבע: החל מ-600₪ (נדרש ייעוץ)
- טיפול הזנה עמוק: 120₪
- החלקת קרטין: 800₪-1200₪
- טיפול אולפלקס: 150₪ (בתוספת לטיפול אחר: 90₪)
- פן ועיצוב: 120₪
- תסרוקת ערב: 350₪
- תסרוקת כלה (כולל ניסיון): 1200₪
שירותי ציפורניים:
- מניקור קלאסי: 80₪
- מניקור ג'ל: 140₪
- מניקור ספא יוקרתי: 180₪
- פדיקור קלאסי: 130₪
- פדיקור ג'ל: 180₪
- פדיקור ספא יוקרתי: 220₪
- קישוטים (עיצוב פשוט): +30₪
- קישוטים (עיצוב מלא): +80₪-120₪
- פרנץ': +30₪
- סט בנייה באקריל: 250₪
- מילוי באקריל: 150₪
- בנייה בג'ל: 280₪
טיפולי פנים ועור:
- טיפול פנים קלאסי (60 דק'): 350₪
- טיפול אנטי-אייג'ינג (75 דק'): 450₪
- טיפול לחות (60 דק'): 380₪
- טיפול לאקנה (60 דק'): 400₪
- טיפול פנים אקספרס (30 דק'): 200₪
- מיקרודרמבריישן: 400₪
- פילינג כימי (קל): 350₪
- טיפול באור (LED): 250₪
- דרמפלנינג: 300₪
שעווה:
- עיצוב גבות: 60₪
- שפם: 40₪
- שעווה בפנים (מלא): 150₪
- בית שחי: 80₪
- חצי רגל: 120₪
- רגל מלאה: 180₪
- שעווה ברזילאית: 200₪
- קו ביקיני: 100₪
כל המחירים כוללים מע"מ. המחירים עשויים להשתנות בהתאם לאורך ועובי השיער.
אנו מקבלים מזומן, כרטיסי אשראי, ביט ו-Apple Pay."""
    },

    # ── Hours ─────────────────────────────────────────────────────────────
    {
        "category": "Hours",
        "title": "שעות פתיחה",
        "content": """מכון היופי של דנה — שעות פתיחה
שעות פעילות רגילות:
- ראשון: 9:00 - 19:00
- שני: 9:00 - 19:00
- שלישי: 9:00 - 20:00 (פתוח עד מאוחר!)
- רביעי: 9:00 - 19:00
- חמישי: 9:00 - 19:00
- שישי: 9:00 - 14:00
- שבת: סגור
שעות בחגים:
- המכון סגור בערבי חג וחגים (אלא אם צוין אחרת)
- שעות פעילות מיוחדות לחגים יפורסמו ברשתות החברתיות שלנו
- לקראת החגים, אנו ממליצים לקבוע תור לפחות שבועיים מראש
תור אחרון יתקבל עד שעה לפני שעת הסגירה.
לקוחות מזדמנים (Walk-ins) יתקבלו בברכה על בסיס מקום פנוי, אך מומלץ לקבוע תור מראש."""
    },

    # ── Location ──────────────────────────────────────────────────────────
    {
        "category": "Location",
        "title": "כתובת ודרכי הגעה",
        "content": """מכון היופי של דנה — מיקום
כתובת: שדרות רוטשילד 123, תל אביב-יפו 6688101
נקודות ציון: ממוקם בין רחוב אלנבי לרחוב הרצל, סמוך לקפה נואר.
דרכי הגעה:
- ברכב: חניה בכחול-לבן זמינה בשדרה. חניון בתשלום ממוקם ברוטשילד 110 (2 דקות הליכה).
- באוטובוס: קווים 5, 18, 61 עוצרים בצומת רוטשילד/אלנבי (דקה הליכה).
- ברכבת הקלה/רכבת: תחנת אלנבי של הרכבת הקלה נמצאת במרחק הליכה קצר.
- באופניים: תחנת תל-אופן ממש מחוץ למכון.
המכון ממוקם בקומת הקרקע ונגיש לכיסאות גלגלים.
חפשו את הסוכך הוורוד-לבן עם הלוגו שלנו!
יצירת קשר:
- טלפון: 03-555-0123
- וואטסאפ: 050-555-0123
- אימייל: hello@danasbeauty.co.il
- אינסטגרם: @danasbeautysalon
- אתר אינטרנט: www.danasbeauty.co.il"""
    },

    # ── Staff ─────────────────────────────────────────────────────────────
    {
        "category": "Staff",
        "title": "הצוות שלנו",
        "content": """הכירו את הצוות במכון היופי של דנה
דנה כהן — בעלים ומעצבת שיער בכירה
- מעל 15 שנות ניסיון בעיצוב וצביעת שיער
- מתמחה בבליאז', תיקוני צבע ותסרוקות כלה
- מוסמכת מטעם L'Oréal Professionnel ו-Wella
- ימי עבודה: ראשון-חמישי
מאיה לוי — מעצבת שיער
- 8 שנות ניסיון
- מתמחה בתספורות מדויקות והחלקות קרטין
- מומחית לשיער מתולתל (מוסמכת DevaCurl)
- ימי עבודה: ראשון-שישי
נור חסן — טכנאית ציפורניים
- 6 שנות ניסיון בבנייה וקישוטי ציפורניים
- מוסמכת בטכניקות ג'ל ואקריל
- ידועה בעיצובים היצירתיים שלה
- ימי עבודה: שני-שישי
יעל מזרחי — קוסמטיקאית פרא-רפואית
- קוסמטיקאית מורשית עם 10 שנות ניסיון
- מתמחה בטיפולי אנטי-אייג'ינג ושיקום העור
- מוסמכת לטיפולי מיקרודרמבריישן ופילינג כימי
- ימי עבודה: ראשון, שלישי, רביעי, שישי
ליאור שפירא — מומחית שעווה ומעצבת שיער צעירה
- 4 שנות ניסיון
- מתמחה בשעווה ברזילאית ושעוות גוף מלאה
- עברה הכשרות גם בעיצוב פן (Blow-dry)
- ימי עבודה: ראשון-חמישי"""
    },

    # ── Policies ──────────────────────────────────────────────────────────
    {
        "category": "Policies",
        "title": "מדיניות ביטולים והזמנות",
        "content": """מכון היופי של דנה — מדיניות ביטולים והזמנות
הזמנת תורים:
- ניתן לקבוע תורים דרך הטלפון, וואטסאפ או דרך בוט הטלגרם שלנו.
- נדרש מספר טלפון תקין לאישור התור.
- אנו ממליצים לקבוע תור 3-5 ימים מראש, במיוחד לסופי שבוע.
- תורים לכלות ואירועים מיוחדים יש לקבוע לפחות שבועיים מראש.
מדיניות ביטולים:
- ביטול חינם אפשרי עד 24 שעות לפני מועד התור.
- ביטולים בהתראה של פחות מ-24 שעות יחויבו ב-50% מעלות הטיפול.
- אי-הגעה (No-show) ללא הודעה תחויב במחיר הטיפול המלא.
- לקוחות שלא הגיעו לתור ללא הודעה יותר מפעם אחת, יידרשו לשלם מקדמה.
איחורים:
- במידה ותאחרו ביותר מ-15 דקות, ייתכן שניאלץ לקבוע מועד חדש או לקצר הטיפול.
- אנא התקשרו לעדכן אם אתם מתעכבים.
מקדמות:
- חבילות כלה דורשות תשלום מקדמה של 30% (ללא החזר כספי במקרה של ביטול).
- שירותי תיקון צבע דורשים פיקדון ייעוץ של 100₪.
- הזמנות קבוצתיות (3 אנשים ומעלה) דורשות מקדמה של 25%."""
    },
    {
        "category": "Policies",
        "title": "מדיניות בטיחות והיגיינה",
        "content": """מכון היופי של דנה — בטיחות והיגיינה
הבריאות והבטיחות שלכם הם בראש סדר העדיפויות שלנו:
היגיינה וחיטוי:
- כל הכלים עוברים חיטוי בדרגה רפואית (אוטוקלאב) בין לקוח ללקוח.
- פריטים חד-פעמיים נזרקים מיד לאחר השימוש.
- עמדות הטיפול עוברות חיטוי יסודי בין תורים.
- אנו משתמשים במגבות וחלוקים נקיים לכל לקוח.
מוצרים:
- משתמשים במוצרים מקצועיים באיכות סלון בלבד.
- כל המוצרים אינם מנוסים על בעלי חיים (Cruelty-free).
- קיימות אפשרויות היפואלרגניות לבעלי עור רגיש.
- מותגים: L'Oréal Professionnel, Olaplex, OPI, CND, Dermalogica.
אלרגיות ורגישויות:
- אנא יידעו אותנו על כל אלרגיה או רגישות לפני תחילת הטיפול.
- טסט רגישות (Patch test) זמין ומומלץ 48 שעות לפני צביעת שיער ראשונה.
- אנו מנהלים רישום אלרגיות במערכת הלקוחות שלנו.
פרוטוקולי אוורור וניקיון:
- מערכת אוורור מתקדמת.
- עמדות אלכוג'ל בכניסה ובכל עמדת טיפול."""
    },

    # ── FAQ ───────────────────────────────────────────────────────────────
    {
        "category": "FAQ",
        "title": "שאלות נפוצות (FAQ)",
        "content": """שאלות נפוצות — מכון היופי של דנה
ש: האם חובה לקבוע תור מראש או שאפשר פשוט להגיע?
ת: אפשר להגיע ללא תור, אבל ממליצים לקבוע מראש. ניתן דרך הטלפון, הוואטסאפ או בוט הטלגרם.
ש: כמה זמן לוקח טיפול צבע לשיער?
ת: צבע אחיד לוקח בין שעה וחצי לשעתיים. גוונים ובליאז' 2-3 שעות. תיקון צבע 3-5 שעות.
ש: האם אתם מוכרים שוברי מתנה (Gift Cards)?
ת: כן! זמינים בכל סכום החל מ-100₪. ניתן לרכוש במכון או להזמין בטלפון.
ש: האם יש חניה באזור?
ת: יש חניה בכחול-לבן לאורך שדרות רוטשילד. חניון בתשלום ברחוב רוטשילד 110.
ש: האם אתם מציעים חבילות כלה?
ת: כן! כולל תור ניסיון ועיצוב ביום האירוע. חבילות למלוות הכלה גם זמינות. קביעת 2 שבועות מראש.
ש: באיזה מוצרים אתם משתמשים?
ת: מותגים מקצועיים כמו L'Oréal Professionnel, Olaplex, OPI, CND ו-Dermalogica. כל המוצרים cruelty-free.
ש: אפשר להביא ילדים למספרה?
ת: ילדים מוזמנים! מציעים תספורות לילדים (עד גיל 12). השגיחו עליהם בכל עת.
ש: האם יש הנחות לחיילים/סטודנטים?
ת: כן! 10% הנחה בהצגת חוגר/תעודת סטודנט בתוקף (לא כולל כפל מבצעים).
ש: אילו אמצעי תשלום אתם מכבדים?
ת: מזומן, כרטיסי אשראי, ביט (Bit) ו-Apple Pay. לא מקבלים צ'קים.
ש: כל כמה זמן מומלץ להסתפר?
ת: לרוב התסרוקות ממליצים על תספורת כל 6-8 שבועות. לגדילת שיער כל 8-12 שבועות."""
    },

    # ── Promotions ────────────────────────────────────────────────────────
    {
        "category": "Promotions",
        "title": "מבצעים והטבות",
        "content": """מבצעים פעילים במכון היופי של דנה (קיץ 2025)
ספיישל קיץ:
- 15% הנחה על כל שירותי צביעת השיער (יוני-אוגוסט 2025).
- בקביעת תור לכל טיפול צבע — טיפול אולפלקס (Olaplex) במתנה (בשווי 150₪).
הטבת לקוח חדש:
- לקוחות חדשים: 20% הנחה על הטיפול הראשון!
- חבר מביא חבר: שניכם תקבלו 50₪ הנחה לטיפול הבא.
מועדון לקוחות:
- על כל 10 שקלים מקבלים נקודה.
- 100 נקודות = 50₪ הנחה לטיפול הבא.
- חודש יום ההולדת: כפל נקודות על כל השירותים!
חבילות משתלמות (Package Deals):
- "חבילת פינוק": תספורת + טיפול פנים + מניקור ב-550₪ (במקום 680₪).
- "חבילת זוהר": טיפול פנים + מניקור + פדיקור ב-500₪ (במקום 560₪).
- "תחזוקה חודשית": מניקור ג'ל + סידור גבות ב-170₪ (במקום 200₪).
הנחת סטודנטים/חיילים:
- 10% הנחה על כל השירותים בהצגת תעודה בתוקף (אין כפל מבצעים).
ספיישל שלישי בערב:
- 10% הנחה על כל השירותים שנקבעים לשעה 18:00 ומעלה בימי שלישי."""
    },
]


def seed_database():
    """Populate the database with demo data."""
    logger.info("Initializing database...")
    db.init_db()

    # Check if data already exists (include inactive entries to avoid duplicates)
    existing = db.get_all_kb_entries(active_only=False)
    if existing:
        logger.info("Database already has %s entries. Skipping seed.", len(existing))
        logger.info("To re-seed, delete the database file first: ai_chatbot/data/chatbot.db")
        return False

    logger.info("Seeding %s knowledge base entries...", len(DEMO_ENTRIES))

    for entry in DEMO_ENTRIES:
        entry_id = db.add_kb_entry(
            category=entry["category"],
            title=entry["title"],
            content=entry["content"],
        )
        logger.info(
            "  Added: [%s] %s (ID: %s)",
            entry["category"],
            entry["title"],
            entry_id,
        )

    logger.info("Seed data inserted successfully!")
    return True


def seed_and_index():
    """Seed the database and build the RAG index."""
    was_seeded = seed_database()

    if was_seeded:
        logger.info("Building RAG index...")
        rebuild_index()
        logger.info("RAG index built successfully!")
    else:
        logger.info("Checking if RAG index needs rebuilding...")
        from ai_chatbot.rag.vector_store import get_vector_store

        store = get_vector_store()
        if store.index is None or store.index.ntotal == 0:
            logger.info("Index is empty. Rebuilding...")
            rebuild_index()
            logger.info("RAG index built successfully!")
        else:
            logger.info("RAG index already exists.")


if __name__ == "__main__":
    seed_and_index()
